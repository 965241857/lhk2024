<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>修改密码 - 毕业设计选题管理系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <style>
        .layui-form-item .layui-input-company {width: auto;padding-right: 10px;line-height: 38px;}
        
        /* 密码强度样式 */
        .password-strength {margin-top: 5px;}
        .strength-item {
            display: inline-block;
            width: 60px;
            height: 6px;
            background-color: #ddd;
            margin-right: 5px;
            border-radius: 3px;
        }
        .strength-item.active {background-color: #FF5722;}
        .strength-text {margin-top: 5px;color: #666;font-size: 12px;}
    </style>
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">

        <div class="layui-form layuimini-form">
            <div class="layui-form-item">
                <label class="layui-form-label required">旧密码</label>
                <div class="layui-input-block">
                    <input type="password" name="old_password" lay-verify="required" lay-reqtext="旧密码不能为空" placeholder="请输入当前使用的密码"  value="" class="layui-input">
                    <tip>请输入您当前登录使用的密码，用于身份验证。</tip>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label required">新密码</label>
                <div class="layui-input-block">
                    <input type="password" name="new_password" lay-verify="required|password" lay-reqtext="新密码不能为空" placeholder="请输入新密码"  value="" class="layui-input" id="newPassword">
                    
                    <!-- 密码强度指示器 -->
                    <div class="password-strength">
                        <div class="strength-item" id="strength1"></div>
                        <div class="strength-item" id="strength2"></div>
                        <div class="strength-item" id="strength3"></div>
                    </div>
                    <div class="strength-text" id="strengthText">请输入新密码</div>
                    
                    <tip>密码长度至少8位，建议包含大小写字母、数字和特殊字符。</tip>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label required">确认新密码</label>
                <div class="layui-input-block">
                    <input type="password" name="again_password" lay-verify="required|confirmPassword" lay-reqtext="确认密码不能为空" placeholder="请再次输入新密码"  value="" class="layui-input">
                    <tip>请再次输入新密码，确保两次输入一致。</tip>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认保存</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
<script>
    layui.use(['form','layer','miniTab'], function () {
        var form = layui.form,
            layer = layui.layer,
            miniTab = layui.miniTab,
            $ = layui.$;

        // 密码强度检测
        $('#newPassword').on('input', function() {
            var val = $(this).val();
            var strength = 0;
            var text = '';
            
            // 密码长度检测
            if (val.length >= 8) {
                strength++;
            }
            
            // 密码复杂度检测（包含大小写字母）
            if (/[A-Z]/.test(val) && /[a-z]/.test(val)) {
                strength++;
            }
            
            // 包含数字或特殊字符
            if (/[0-9]/.test(val) || /[^A-Za-z0-9]/.test(val)) {
                strength++;
            }
            
            // 更新强度显示
            $('.strength-item').removeClass('active');
            for (var i = 1; i <= strength; i++) {
                $('#strength' + i).addClass('active');
            }
            
            // 更新强度文本提示
            switch(strength) {
                case 0: text = '密码强度：弱（请至少输入8个字符）'; break;
                case 1: text = '密码强度：弱（建议增加字母大小写组合）'; break;
                case 2: text = '密码强度：中（建议增加数字或特殊字符）'; break;
                case 3: text = '密码强度：强（很好，继续保持）'; break;
            }
            $('#strengthText').text(text);
        });

        // 自定义验证规则
        form.verify({
            password: function(value) {
                if (value.length < 8) {
                    return '密码长度不能少于8位';
                }
                if (!/[A-Za-z]/.test(value) || !/[0-9]/.test(value)) {
                    return '密码必须包含字母和数字';
                }
            },
            confirmPassword: function(value) {
                var newPassword = $('input[name="new_password"]').val();
                if (value !== newPassword) {
                    return '两次输入的密码不一致';
                }
            }
        });

        // 监听提交
        form.on('submit(saveBtn)', function (data) {
            // 验证新旧密码是否相同
            if (data.field.old_password === data.field.new_password) {
                layer.msg('新密码不能与旧密码相同', {icon: 5});
                return false;
            }
            
            // 模拟提交到服务器
            layer.load(2);
            setTimeout(function() {
                layer.closeAll('loading');
                layer.msg('密码修改成功，系统将重新登录', {icon: 1}, function() {
                    // 关闭当前标签页
                    miniTab.deleteCurrentByIframe();
                    // 实际应用中可跳转到登录页
                    // window.top.location.href = '../page/login.html';
                });
            }, 1000);
            
            return false;
        });

    });
</script>
</body>
</html>
